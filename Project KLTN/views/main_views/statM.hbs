
<div class="contain">
    <div class="binStat">
        <div class="listContain">
            <div class="listTitle">List bins</div>
            <div class="listContent">
                <ul id="listBins">

                </ul>
            </div>
            <div id="overallBin">Overall</div>
        </div>
        <div class="content">
            <div id="overAllContent" class="active" bin-chart-content>
                <div class="contentTitle">Overall</div>
                <div class="timeBar">
                    <ul class="times">
                        <li id="timeBins7d" class="active tabDay">7 Days</li>
                        <li id="timeBins30d" class="tabDay">30 Days</li>
                    </ul>
                </div>
                <div class="overAllChart">
                    <div id="contentPt">
                        <div class="chartTitle">Penalty Time</div>
                        <div class="total" id="ptTotal">ABC</div>
                        <canvas id="ptChart" style="width:80%;"></canvas>
                    </div>
                    <div id="contentDens">
                        <div class="chartTitle">Density</div>
                        <div class="total" id="densTotal">ABC</div>
                        <canvas id="densChart" style="width:80%;"></canvas>
                    </div>
                </div>
            </div>
            <div id="eachBinContent" bin-chart-content>
                <div class="contentTitle" id="binName">Bin</div>
                <div class="tab">
                    <div class="timeBar">
                        <ul class="times">
                            <li id="timeBin7d" class="active tabDay">7 Days</li>
                            <li id="timeBin30d" class="tabDay">30 Days</li>
                        </ul>
                    </div>
                    <div class="modeBar">
                        <ul class="modes">
                            <li id="modePt" class="active tabMode" data-tab-target="#contentBinPt">Pen time</li>
                            <li id="modeDens" class="tabMode" data-tab-target="#contentBinDens">Density</li>
                            <li id="modeWarn" class="tabMode" data-tab-target="#contentBinWarn" style="display: none;">Warning</li>
                        </ul>
                    </div>
                </div>
                <div class="binChart">
                    <div id="contentBinPt" class="active" data-tab-content>
                        <canvas id="ptBarChart"></canvas>
                    </div>
                    <div id="contentBinDens" data-tab-content>
                        <canvas id="densBarChart"></canvas>
                    </div>
                    <div id="contentBinWarn" data-tab-content>
                        <div id="warning">ABCFJKEFJK</div>
                        <div id="detail">hfjshjfsjfshjfs</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="carStat">
        <div class="listContain">
            <div class="listTitle">List trucks</div>
            <div class="listContent">
                <ul id="listCars">
                    
                </ul>
            </div>
            <div id="overallCar">Overall</div>
        </div>
        <div class="content">
            <div id="ovCarsContent" class="active" car-chart-content>
                <div class="contentTitle">Overall</div>
                <div id="contentDist">
                    <div class="chartTitle">Distance</div>
                    <div class="total" id="distTotal">ABC</div>
                    <canvas id="distChart"></canvas>
                </div>
            </div>
            <div id="eachCarContent" car-chart-content>
                <div class="contentTitle" id="carName">Bin</div>
                <div id="contentCarDist">
                    <div class="chartTitle">Distance</div>
                    <canvas id="distBarChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="footer"></div>
</div>

<script>
    var cars = decodeURIComponent("{{{cars}}}");
    cars = JSON.parse(cars);
    var bins = decodeURIComponent("{{{bins}}}");
    bins = JSON.parse(bins);
    const tabs = document.querySelectorAll("[data-tab-target]");
    const tabContents = document.querySelectorAll("[data-tab-content]");
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const target = document.querySelector(tab.dataset.tabTarget);
            tabContents.forEach(tabContent => {
                tabContent.classList.remove('active');
            });
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            tab.classList.add('active');
            target.classList.add('active');
        });
    });
    var pentimePerBin = [];
    var densityPerBin = [];
    var suggest = [];
    var penTime7D = 0;
    var penTime30D = 0;
    var dens7D = 0;
    var dens30D = 0;
    var dist = 0;
    for(var i = 0; i < bins.length; i++){
        var tempPt = 0;
        var tempDens = 0;
        for(var j = bins[i].penalty_time.length-1; j >= 0; j--){
            if(j >= bins[i].penalty_time.length-7){
                penTime7D += bins[i].penalty_time[j].time;
            }
            tempPt += bins[i].penalty_time[j].time;
        }
        penTime30D += tempPt;
        pentimePerBin.push(tempPt);
        for(var j = bins[i].density.length-1; j >= 0; j--){
            if(j >= bins[i].density.length-7){
                dens7D += bins[i].density[j].weight;
            }
            tempDens += bins[i].density[j].weight; 
        }
        dens30D += tempDens;
        densityPerBin.push(tempDens);
    }
    for(var i = 0; i < bins.length; i++){
        if(pentimePerBin[i]/bins[i].penalty_time.length > 45 && densityPerBin[i]/bins[i].density.length > bins[i].capacity*3){
            suggest.push(1);
        }
        else if(densityPerBin[i]/bins[i].density.length < bins[i].capacity*0.5){
            suggest.push(-1);
        }
        else{
            suggest.push(0);
        }
    }
    for(var i = 0; i < cars.length; i++){
        for(var j = 0; j < cars[i].opDist.length; j++){
            dist += cars[i].opDist[j].distance;
        }
    }
</script>